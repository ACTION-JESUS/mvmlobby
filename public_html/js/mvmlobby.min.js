function upsertFriend(t,e,a,i,s){$.ajax({url:"mvmlobbyAPI.php",type:"POST",data:{apitype:"upsert",action:"upsertFriend",friend_steamid:t,favorite:e?"1":"0",subaction:a?"remove":"update_friend_status"}}).done(function(t){i&&i(t)}).fail(function(t){s&&s(t)})}function upsertNote(t,e,a,i,s){$.ajax({url:"mvmlobbyAPI.php",type:"POST",data:{apitype:"upsert",action:"upsertNote",targetSteamID:t,note:e,is_public:a}}).done(function(t){i&&i(t)}).fail(function(t){s&&s(t)})}function getPlayerData(t,e,a,i){$.ajax({type:"GET",url:"mvmlobbyAPI.php",data:{apitype:"getPlayerData",steamid:t,forcerefresh:e}}).fail(function(t){i&&i(t)}).done(function(t){a&&a(t)})}function Player(t){this.steamid=t.steamid,this.id=t.id,this.name=t.name,this.region=t.region,this.site_status=t.site_status,this.image_url_small=t.image_url_small,this.image_url_medium=t.image_url_medium,this.image_url_large=t.image_url_large,this.favorite=t.favorite,this.inventory_unavailable=t.inventory_unavailable,this.profile_visibility=t.profile_visibility,this.inventory_status=t.inventory_status,this.steam3id=t.steam3id,this.robots_killed=t.robots_killed,this.is_playing_tf2=t.is_playing_tf2,this.current_mvm_mission_id=t.current_mvm_mission_id,this.current_mvm_mission_name=t.current_mvm_mission_name,this.mission_wiki_url=t.mission_wiki_url,this.current_game_name=t.current_game_name,this.current_game_ipport=t.current_game_ipport,this.inventory_last_updated=t.inventory_last_updated,this.ticketCount=t.ticketCount,this.totalTours=t.totalTours,this.tourArray=t.tourArray,this.last_known_status_code=t.last_known_status_code,this.summary_last_updated_in_minutes=t.summary_last_updated_in_minutes,this.inventory_last_updated_in_minutes=t.inventory_last_updated_in_minutes,this.summary_display_age=t.summary_display_age,this.inventory_display_age=t.inventory_display_age,this.status=t.status,this.status_color=t.status_color}function changeDisplayValue(t,e,a){var i=800,s=t.html();s!=e&&t.fadeOut(i,"swing",function(){t.html(e),a&&t.css("color",a),t.fadeIn(i)})}function HeaderView(){this.update=function(t){changeDisplayValue($("#headerTicketsOwned"),t.ticketCount),changeDisplayValue($("#headerTotalTours"),t.totalTours)}}function PlayerHeaderController(t){this.user=null,this.headerView=null,this.refreshData=function(){getPlayerData(t,0,this.onFetchSuccess)},this.onFetchSuccess=function(t){t&&t.player&&(this.user=new Player(t.player),this.headerView=new HeaderView,this.headerView.update(this.user))}}function DetailView(){this.update=function(t){var e=$("#playerdetails [player_attr]"),a=(e.find("[player_attr=ticketcount]"),"?");t.robots_killed>=0&&(a=1e6==t.robots_killed?">1,000,000":t.robots_killed.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),changeDisplayValue(e.filter("[player_attr=name]"),t.name),changeDisplayValue(e.filter("[player_attr=ticketcount]"),t.ticketCount),changeDisplayValue(e.filter("[player_attr=totaltours]"),t.totalTours),changeDisplayValue(e.filter("[player_attr=robotskilled]"),a);var i=e.filter("[player_attr=steamstatus]");i.off("click"),i.css("color",t.status_color),t.current_mvm_mission_name?(changeDisplayValue(i,'<a style="color: '+t.status_color+'" href="#" onclick="return false;">'+t.status+"</a>"),i.on("click",function(){return displayServerInfo(t.current_game_ipport,t.current_mvm_mission_name,t.player_wiki_url),!1})):changeDisplayValue(i,t.status);for(var s in t.tourArray){var r=t.tourArray[s],n=0,l=r.mission_bitmask?r.mission_bitmask:0;$missionList=e.filter("[player_attr=mission][tour_id="+s+"]"),$missionList.each(function(){var t=$(this).attr("bitmask");(l&t)==t?(changeDisplayValue($(this),"Complete","#00aa00"),++n):changeDisplayValue($(this),"Incomplete","#aa0000")});var o=r.tours_completed?r.tours_completed:0,u='<span style="font-weight: bold;">'+o+"</span> tour"+(1==o?"":"s")+" ("+n+"/"+$missionList.length+")";changeDisplayValue(e.filter("[player_attr=tours_completed][tour_id="+s+"]"),u)}changeDisplayValue(e.filter("[player_attr=inventory_display_age]"),t.inventory_display_age),$("#mvmDataStatus").html("MvM data is current within the past 15 minutes.").css("color","#070")}}function PlayerDetailController(t){var e=null,a=new DetailView;this.refreshData=function(){getPlayerData(t,0,this.onFetchSuccess)},this.onFetchSuccess=function(t){t&&t.player&&(e=new Player(t.player),a.update(e))}}